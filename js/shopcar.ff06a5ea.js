(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["shopcar"],{c4b4:function(t,s,e){"use strict";e.r(s);var o=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{attrs:{id:"shopcar"}},[e("b-container",{staticClass:"shadow",staticStyle:{"min-height":"68vh"}},[e("b-row",[e("b-breadcrumb",{staticClass:"mt-2 ml-3",attrs:{items:t.breads}}),t.step1?e("b-col",{attrs:{cols:"12"}},[e("b-container",[e("b-row",[e("b-col",{staticClass:"mx-auto d-flex justify-content-around align-items-center",attrs:{cols:"12",lg:"6"}},[e("div",{staticClass:"step"},[e("p",[t._v("1")])]),e("font-awesome-icon",{staticClass:"h3 m-0",attrs:{icon:["fas","arrow-alt-circle-right"]}}),e("div",{staticClass:"step "},[e("p",[t._v("2")])]),e("font-awesome-icon",{staticClass:"h3 m-0",attrs:{icon:["fas","arrow-alt-circle-right"]}}),e("div",{staticClass:"step "},[e("p",[t._v("3")])])],1)],1)],1),e("hr"),e("div",{staticClass:"bg-white pb-3"},[e("b-table",{staticClass:"mx-auto  text-center rounded mt-3 p-5",attrs:{stacked:"md",id:"formstable",items:t.cartproducts,fields:t.fields},scopedSlots:t._u([{key:"cell(selected)",fn:function(s){return[e("b-form-checkbox",{on:{change:t.changeSelect},model:{value:s.item.select,callback:function(e){t.$set(s.item,"select",e)},expression:"data.item.select"}})]}},{key:"cell(img)",fn:function(t){return[e("img",{attrs:{src:t.item.p_id.src}})]}},{key:"cell(amount)",fn:function(s){return[e("b-form-spinbutton",{attrs:{size:"sm",id:"amount",min:"1",max:s.item.p_id.amount},on:{change:function(e){return t.changeamount(s)}},model:{value:s.item.amount,callback:function(e){t.$set(s.item,"amount",e)},expression:"data.item.amount"}})]}},{key:"cell(price)",fn:function(s){return[s.item.p_id.onsale?e("p",{staticClass:"text-danger p-0 m-0"},[t._v(t._s(s.item.p_id.countPrice))]):e("p",{staticClass:"p-0 m-0"},[t._v(t._s(s.item.p_id.price))])]}},{key:"cell(total)",fn:function(s){return[s.item.p_id.onsale?e("p",{staticClass:"p-0 m-0"},[t._v(t._s(s.item.amount*s.item.p_id.countPrice))]):e("p",{staticClass:"p-0 m-0"},[t._v(t._s(s.item.amount*s.item.p_id.price))])]}},{key:"cell(delete)",fn:function(s){return[e("b-button",{staticStyle:{background:"transparent"},on:{click:function(e){return t.delshopitem(s.index)}}},[e("font-awesome-icon",{staticClass:"text-danger h3 m-0",attrs:{icon:["fas","trash-alt"]}})],1)]}}],null,!1,2553173766)}),0===t.cartproducts.length?e("P",{staticClass:"text-center my-5"},[t._v("目前沒有商品")]):t._e()],1),e("hr"),e("b-row",[e("b-col",{staticClass:"steps ml-auto",attrs:{cols:"12",lg:"5"}},[e("p",{staticClass:"h4 mb-3"},[t._v("總計: $"+t._s(t.total))]),e("div",{staticClass:"d-flex"},[e("b-button",{staticClass:"next mb-3 w-100",attrs:{to:"/products"}},[t._v("回商品列表")]),e("b-button",{staticClass:"next mb-3 w-100 ml-5",on:{click:t.tostep2}},[t._v("下一步")])],1)])],1)],1):t._e(),t.step2?e("b-col",{attrs:{cols:"12"}},[e("b-container",[e("b-row",[e("b-col",{staticClass:"mx-auto d-flex justify-content-around align-items-center",attrs:{cols:"12",lg:"6"}},[e("div",{staticClass:"step step2"},[e("p",[t._v("1")])]),e("font-awesome-icon",{staticClass:"h3 m-0",attrs:{icon:["fas","arrow-alt-circle-right"]}}),e("div",{staticClass:"step step2"},[e("p",[t._v("2")])]),e("font-awesome-icon",{staticClass:"h3 m-0",attrs:{icon:["fas","arrow-alt-circle-right"]}}),e("div",{staticClass:"step step2"},[e("p",[t._v("3")])])],1)],1)],1),e("hr"),t.step2?e("b-form",{staticClass:"bg-white p-3"},[e("b-row",[e("b-col",{attrs:{cols:"6"}},[e("font-awesome-icon",{staticClass:"h5 m-0",attrs:{icon:["fas","truck"]}}),e("h5",{staticClass:"d-inline ml-2"},[t._v("運送方式 :")]),e("b-form-group",{staticClass:"mt-3 ml-3"},[e("b-form-radio-group",{staticClass:"mb-2",attrs:{id:"order1",stacked:"",name:"order1",options:t.howtosend},model:{value:t.order.howtosend,callback:function(s){t.$set(t.order,"howtosend",s)},expression:"order.howtosend"}}),100===t.order.howtosend.shipping||120===t.order.howtosend.shipping?e("div",{staticClass:"ml-4"}):t._e(),20===t.order.howtosend.shipping||30===t.order.howtosend.shipping||80===t.order.howtosend.shipping||70===t.order.howtosend.shipping?e("b-form-input",{attrs:{placeholder:"門市 "},model:{value:t.order.howtosend.where,callback:function(s){t.$set(t.order.howtosend,"where",s)},expression:"order.howtosend.where"}}):t._e(),120===t.order.howtosend.shipping||100===t.order.howtosend.shipping?e("b-form-input",{attrs:{placeholder:"地址"},model:{value:t.order.howtosend.where,callback:function(s){t.$set(t.order.howtosend,"where",s)},expression:"order.howtosend.where"}}):t._e()],1),e("font-awesome-icon",{staticClass:"h5 m-0",attrs:{icon:["fas","money-bill"]}}),e("h5",{staticClass:"d-inline ml-2"},[t._v("付款方式 :")]),0===t.order.howtosend.shipping||100===t.order.howtosend.shipping||120===t.order.howtosend.shipping||30===t.order.howtosend.shipping||20===t.order.howtosend.shipping?e("b-form-group",{staticClass:"ml-3 mt-3"},[e("b-form-radio",{attrs:{value:"Line Pay",name:"order2"},model:{value:t.order.howtosend.howtopay,callback:function(s){t.$set(t.order.howtosend,"howtopay",s)},expression:"order.howtosend.howtopay"}},[t._v("Line Pay")]),e("b-form-radio",{attrs:{value:"銀行轉帳",name:"order2"},model:{value:t.order.howtosend.howtopay,callback:function(s){t.$set(t.order.howtosend,"howtopay",s)},expression:"order.howtosend.howtopay"}},[t._v("轉帳"),"銀行轉帳"===t.order.howtosend.howtopay&&""===t.user.payaccount?e("b-form-input",{staticClass:"my-1",attrs:{size:"sm"},model:{value:t.order.payaccount,callback:function(s){t.$set(t.order,"payaccount",s)},expression:"order.payaccount"}}):t._e(),"銀行轉帳"===t.order.howtosend.howtopay&&""!==t.user.payaccount?e("p",{staticClass:"m-0 my-2"},[t._v(t._s(t.user.payaccount))]):t._e()],1),e("b-form-radio",{staticClass:"mb-2",attrs:{value:"PChomePay",name:"order2"},model:{value:t.order.howtosend.howtopay,callback:function(s){t.$set(t.order.howtosend,"howtopay",s)},expression:"order.howtosend.howtopay"}},[t._v("PChomePay")])],1):e("p",{staticClass:"ml-3 mt-3"},[t._v(" 貨到付款無需選擇付款方式")])],1),e("b-col",{attrs:{cols:"12",lg:"6"}},[e("font-awesome-icon",{staticClass:"h5 m-0",attrs:{icon:["fas","user-astronaut"]}}),e("h5",{staticClass:"d-inline ml-2"},[t._v("收件人資訊 :")]),e("div",{staticClass:"d-flex mt-3 ml-3"},[e("p",{staticClass:"mr-2 mb-0"},[t._v("姓名 :")]),t.isedit?e("b-form-input",{staticClass:"w-25",attrs:{size:"sm"},model:{value:t.user.name,callback:function(s){t.$set(t.user,"name",s)},expression:"user.name"}}):e("p",{staticClass:"mb-0"},[t._v(t._s(t.user.name))])],1),e("div",{staticClass:"d-flex mt-4 ml-3"},[e("p",{staticClass:"mr-2 m-0"},[t._v("電話 :")]),t.isedit?e("b-form-input",{staticClass:"w-25",attrs:{size:"sm"},model:{value:t.user.phone,callback:function(s){t.$set(t.user,"phone",s)},expression:"user.phone"}}):e("p",{staticClass:"m-0"},[t._v(" "+t._s(t.user.phone))])],1),e("b-button",{staticClass:"d-block my-3 ml-3",staticStyle:{"font-size":"0.8rem"},attrs:{size:"sm"},on:{click:t.checkedit}},[t.isedit?e("p",{staticClass:"m-0"},[t._v("確定")]):e("p",{staticClass:"my-1 w-100"},[t._v("修改收件資訊")])]),e("font-awesome-icon",{staticClass:"h5 m-0",attrs:{icon:["fas","sticky-note"]}}),e("label",{staticClass:"w-100 d-inline h5 ml-2"},[t._v("備註 :"),e("b-form-textarea",{staticClass:"w-100 mt-3",attrs:{rows:"5",placeholder:"請輸入"},model:{value:t.order.note,callback:function(s){t.$set(t.order,"note",s)},expression:"order.note"}})],1)],1)],1)],1):t._e(),e("hr"),e("b-row",[e("b-col",{staticClass:"ml-auto text-right",attrs:{cols:"12"}},[e("p",[t._v(" "+t._s(t.order.howtosend.method)+" "+t._s(t.order.howtosend.howtopay))]),e("p",[t._v("運費: $"+t._s(t.order.howtosend.shipping))]),e("p",{staticClass:"h3 mb-3"},[t._v("總計: $"+t._s(t.total+t.order.howtosend.shipping))]),e("div",[e("b-row",[e("b-col",{staticClass:"ml-auto",attrs:{cols:"12",lg:"5"}},[e("div",{staticClass:"d-flex"},[e("b-button",{staticClass:"mb-3 w-100",on:{click:t.tostep1}},[t._v("上一步")]),e("b-button",{staticClass:"next mb-3 w-100 ml-5",on:{click:function(s){return t.buy(t.user)}}},[t._v(" 確定購買")])],1)])],1)],1)])],1)],1):t._e(),t.step3?e("b-col",{attrs:{cols:"12"}},[e("b-container",[e("b-row",[e("b-col",{staticClass:"mx-auto d-flex justify-content-around align-items-center",attrs:{cols:"12",lg:"6"}},[e("div",{staticClass:"step step3"},[e("p",[t._v("1")])]),e("font-awesome-icon",{staticClass:"h3 m-0",attrs:{icon:["fas","arrow-alt-circle-right"]}}),e("div",{staticClass:"step step3"},[e("p",[t._v("2")])]),e("font-awesome-icon",{staticClass:"h3 m-0",attrs:{icon:["fas","arrow-alt-circle-right"]}}),e("div",{staticClass:"step step3"},[e("p",[t._v("3")])])],1)],1)],1),e("hr"),e("div",{staticClass:"thank d-flex justify-content-center align-items-center rounded"},[e("div",[e("p",{staticClass:"m-0"},[t._v("謝謝您的購買與支持")]),e("p",[t._v("Thank You !")]),e("p",[t._v("收到商品後有任何問題,請盡量於三天內與我們聯繫,我們會盡快為您處理")]),e("p",[t._v("電話 : 0988555555 (02)2300-9966")])])]),e("hr"),e("b-col",{staticClass:"steps ml-auto",attrs:{cols:"12",lg:"5"}},[e("div",{staticClass:"d-flex"},[e("b-button",{staticClass:"next mb-3 w-100",attrs:{to:"/"}},[t._v("回首頁")]),e("b-button",{staticClass:"next mb-3 w-100 ml-5",attrs:{to:"/products"}},[t._v("繼續購買")])],1)])],1):t._e()],1)],1)],1)},a=[],i=(e("4de4"),e("d81d"),e("a434"),e("b0c0"),{components:{},name:"Home",data:function(){return{order:{howtosend:{method:null,howtopay:null,shipping:0,where:null},address:"",note:"",payaccount:""},howtosend:[{text:"7-11 取貨付款 80 元",value:{method:"7-11 ",howtopay:"取貨付款",shipping:80}},{text:"7-11 取貨 30 元",value:{method:"7-11 ",howtopay:"取貨",shipping:30}},{text:"全家 取貨付款 70 元",value:{method:"全家 ",howtopay:"取貨付款",shipping:70}},{text:"全家 取貨 20 元",value:{method:"全家",howtopay:"取貨",shipping:20}},{text:"黑貓宅急便 120元",value:{method:"黑貓宅急便",shipping:120}},{text:"郵寄 100元",value:{method:"郵寄",shipping:100}},{text:"自取",value:{method:"自取",shipping:0,where:null}}],isedit:!1,step1:!0,step2:!1,step3:!1,amount:1,images:[],breads:[{text:"首頁",to:"/"},{text:"購物車",active:!0}],fields:[{key:"selected",label:""},{key:"p_id.productNumber",label:"商品編號"},{key:"img",label:"圖片"},{key:"p_id.name",label:"商品名稱"},{key:"price",label:"價格"},{key:"amount",label:"數量"},{key:"total",label:"小計"},{key:"delete",label:"刪除"}]}},computed:{user:function(){return this.$store.state.user},cartproducts:function(){return this.$store.state.user.shopcar},total:function(){for(var t=0,s=0;s<this.cartproducts.length;s++){var e=this.cartproducts[s];!1===e.p_id.onsale?t+=e.p_id.price*e.amount:t+=e.p_id.countPrice*e.amount}return t}},methods:{changeSelect:function(){this.$store.commit("changeSelect",this.user),this.axios.patch("https://buyfig-bowen.herokuapp.com/users/edit/"+this.user.id,{shopcar:this.cartproducts}).then((function(t){}))},changeamount:function(t){this.axios.patch("https://buyfig-bowen.herokuapp.com/users/edit/"+this.user.id,{shopcar:this.cartproducts}).then((function(t){}))},checkedit:function(){this.isedit=!this.isedit},delshopitem:function(t){this.$store.state.user.shopcar.splice(t,1),this.axios.patch("https://buyfig-bowen.herokuapp.com/users/edit/"+this.$store.state.user.id,{shopcar:this.$store.state.user.shopcar}).then((function(t){}))},tostep1:function(){this.step1=!0,this.step2=!1},tostep2:function(){0===this.cartproducts.length?this.$swal.fire({toast:!0,position:"bottom-start",padding:"1rem",icon:"warning",title:"購物車沒有商品",showConfirmButton:!1,timer:3e3}):(this.step1=!1,this.step2=!0)},buy:function(t){var s=this;!0===t.isBan?this.$swal.fire({toast:!0,position:"bottom-start",padding:"1rem",icon:"error",title:"封鎖中，欲解鎖請洽客服",showConfirmButton:!1,timer:3e3}):0===this.cartproducts.length?this.$swal.fire({toast:!0,position:"bottom-start",padding:"1rem",icon:"warning",title:"購物車沒有商品",showConfirmButton:!1,timer:3e3}):this.$swal.fire({width:"20rem",padding:"1rem",title:"確認購買",showDenyButton:!0,showCancelButton:!1,denyButtonText:"取消",confirmButtonText:"確定"}).then((function(e){if(e.isConfirmed){s.step3=!0,s.step1=!1,s.step2=!1;var o=new Date,a=o.getFullYear(),i=o.getMonth()-1,r=o.getDate(),n=s.user.name,c=s.user.phone,l=a+"/"+i+"/"+r,p=s.order.howtosend.where,d=s.order.howtosend.method,h=s.order.howtosend.howtopay,u="";u="銀行轉帳"===s.order.howtosend.howtopay&&""!==t.payaccount?s.user.payaccount:s.order.payaccount;var m=s.order.note,w=s.order.howtosend.shipping,f=s.total+s.order.howtosend.shipping;t.orders.push({name:n,phone:c,date:l,where:p,method:d,payaccount:u,howtopay:h,shipment:"未出貨",ispaid:!1,note:m,shipping:w,total:f,products:s.cartproducts.filter((function(t){return!0===t.select}))}),s.axios.patch("https://buyfig-bowen.herokuapp.com/users/edit/"+t.id,{lastbuydate:l,orders:t.orders}).then((function(e){for(var o=0;o<t.shopcar.length;o++)s.axios.patch("https://buyfig-bowen.herokuapp.com/products/edit/"+t.shopcar[o].p_id._id,{amount:t.shopcar[o].p_id.amount-=t.shopcar[o].amount,sold:t.shopcar[o].p_id.sold+=t.shopcar[o].amount}).then((function(e){s.axios.patch("https://buyfig-bowen.herokuapp.com/users/edit/"+t.id,{shopcar:s.cartproducts.filter((function(t){return!0!==t.select}))}).then((function(t){s.$store.commit("cartproducts",s.cartproducts.filter((function(t){return!0!==t.select})))}))}))}))}}))}},mounted:function(){var t=this;this.axios.get("https://buyfig-bowen.herokuapp.com/users/"+this.$store.state.user.id).then((function(s){t.images=s.data.result.shopcar.map((function(t){return t.p_id.src="https://buyfig-bowen.herokuapp.com/products/"+t.p_id.images[0].file,t}));var e=t.images;t.$store.commit("cartproducts",e)}))}}),r=i,n=e("2877"),c=Object(n["a"])(r,o,a,!1,null,null,null);s["default"]=c.exports}}]);
//# sourceMappingURL=shopcar.ff06a5ea.js.map